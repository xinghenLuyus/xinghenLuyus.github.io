{"title":"Wireguard 在 Windows 中的亿点点细节","slug":"2025-12-15","date":"2025-12-14T16:00:00.000Z","updated":"2025-12-15T03:49:51.338Z","comments":true,"path":"api/articles/2025-12-15.json","excerpt":null,"covers":["https://bu.dusays.com/2025/12/15/693f7b9240832.png","https://github-readme-stats.vercel.app/api/pin/?username=xinghenLuyus&repo=fast_fullmesh&show_owner=true"],"content":"<h2 id=\"1-Windows-杂谈\"><a href=\"#1-Windows-杂谈\" class=\"headerlink\" title=\"1 Windows 杂谈\"></a>1 Windows 杂谈</h2><p>作为使用人数最多，覆盖最广的操作系统，是组网绕不开的。且不说60%的开发者使都使用Windows开发程序，很多的游戏，剪辑软件，显卡驱动都更加贴合Windows。</p>\n<p>Linux以简洁的命令，清晰的架构，快捷的程序安装，成为了无数服务喜爱的温床。Wireguard在Linux中可以被方便的部署，配置。</p>\n<p>多年使用Wireguard的我总结了多项Wireguard在Windows中的痛点，有了我的解决方案。</p>\n<h2 id=\"2-命令行操作\"><a href=\"#2-命令行操作\" class=\"headerlink\" title=\"2 命令行操作\"></a>2 命令行操作</h2><p>正常来看，Windows只能通过UI界面对接口进行操作，UI关闭后网络接口将会被关闭。所有配置的导入，修改，都依赖UI (ssh噩梦)。</p>\n<p>不同于Linux有<code>wg-quick</code>接口控制工具，Windows只保留了最原始wg工具。但少有人知道，<code>wireguard.exe</code>本身不止是一个UI，还是一个命令行工具。</p>\n<p><img src=\"https://bu.dusays.com/2025/12/15/693f7b9240832.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/12/15/693f7b9240832.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"></p>\n<p>将Wireguard目录添加系统环境变量(默认安装时已经添加)，然后彻底关闭UI页面(再见了UI)。</p>\n<ul>\n<li>安装新接口作为系统服务(后台安装，不会开启UI接口，类似与<code>wg-quick</code>，且重启不会丢失)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wireguard.exe /installtunnelservice <span class=\"string\">&quot;%CONF_PATH%&quot;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>卸载同理</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wireguard.exe /uninstalltunnelservice <span class=\"string\">&quot;%WG_INTERFACE%&quot;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>wg 工具和 Linux 一样，包括 <code>wg show</code> 和 <code>wg sync</code> ，这里不再赘述。</li>\n</ul>\n<h2 id=\"3-IP转发\"><a href=\"#3-IP转发\" class=\"headerlink\" title=\"3 IP转发\"></a>3 IP转发</h2><p>两者类似，但是要注意Windows要在powershell运行命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">sysctl -w net.ipv4.ip_forward=1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\">Get-NetIPInterface</span><br><span class=\"line\">Set-NetIPInterface -Forwarding Enabled</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-跨接口转发\"><a href=\"#4-跨接口转发\" class=\"headerlink\" title=\"4 跨接口转发\"></a>4 跨接口转发</h2><ul>\n<li>将Windows下Wireguard网络接口级别设置为<code>Private</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Set-NetConnectionProfile -InterfaceAlias <span class=\"string\">&quot;%WG_INTERFACE%&quot;</span> -NetworkCategory Private</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启用NAT转发Wireguard流量到别的接口</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">New-NetNat -Name <span class=\"string\">&quot;WG-NAT&quot;</span> -InternalIPInterfaceAddressPrefix %WG_ALL_IPS%</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>等价于以下Linux命令</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -t nat -A POSTROUTING -s %WG_ALL_IPS% -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure>\n\n<span class='p center h1 black'>欢迎查看我的项目 fast_fullmesh</span>\n\n<p>WGDashboard 插件,用于自动生成 WireGuard 配置(Half Mesh),客户端主动订阅配置,集中管理。</p>\n<a class=\"ghcard\" rel=\"external nofollow noopener noreferrer\" href=\"https://github.com/xinghenLuyus/fast_fullmesh\"><img src=\"https://github-readme-stats.vercel.app/api/pin/?username=xinghenLuyus&repo=fast_fullmesh&show_owner=true\" class=\"lazyload\" data-srcset=\"https://github-readme-stats.vercel.app/api/pin/?username=xinghenLuyus&repo=fast_fullmesh&show_owner=true\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"/></a>\n\n\n","more":"<h2 id=\"1-Windows-杂谈\"><a href=\"#1-Windows-杂谈\" class=\"headerlink\" title=\"1 Windows 杂谈\"></a>1 Windows 杂谈</h2><p>作为使用人数最多，覆盖最广的操作系统，是组网绕不开的。且不说60%的开发者使都使用Windows开发程序，很多的游戏，剪辑软件，显卡驱动都更加贴合Windows。</p>\n<p>Linux以简洁的命令，清晰的架构，快捷的程序安装，成为了无数服务喜爱的温床。Wireguard在Linux中可以被方便的部署，配置。</p>\n<p>多年使用Wireguard的我总结了多项Wireguard在Windows中的痛点，有了我的解决方案。</p>\n<h2 id=\"2-命令行操作\"><a href=\"#2-命令行操作\" class=\"headerlink\" title=\"2 命令行操作\"></a>2 命令行操作</h2><p>正常来看，Windows只能通过UI界面对接口进行操作，UI关闭后网络接口将会被关闭。所有配置的导入，修改，都依赖UI (ssh噩梦)。</p>\n<p>不同于Linux有<code>wg-quick</code>接口控制工具，Windows只保留了最原始wg工具。但少有人知道，<code>wireguard.exe</code>本身不止是一个UI，还是一个命令行工具。</p>\n<p><img src=\"https://bu.dusays.com/2025/12/15/693f7b9240832.png\"></p>\n<p>将Wireguard目录添加系统环境变量(默认安装时已经添加)，然后彻底关闭UI页面(再见了UI)。</p>\n<ul>\n<li>安装新接口作为系统服务(后台安装，不会开启UI接口，类似与<code>wg-quick</code>，且重启不会丢失)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wireguard.exe /installtunnelservice <span class=\"string\">&quot;%CONF_PATH%&quot;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>卸载同理</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wireguard.exe /uninstalltunnelservice <span class=\"string\">&quot;%WG_INTERFACE%&quot;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>wg 工具和 Linux 一样，包括 <code>wg show</code> 和 <code>wg sync</code> ，这里不再赘述。</li>\n</ul>\n<h2 id=\"3-IP转发\"><a href=\"#3-IP转发\" class=\"headerlink\" title=\"3 IP转发\"></a>3 IP转发</h2><p>两者类似，但是要注意Windows要在powershell运行命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">sysctl -w net.ipv4.ip_forward=1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\">Get-NetIPInterface</span><br><span class=\"line\">Set-NetIPInterface -Forwarding Enabled</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-跨接口转发\"><a href=\"#4-跨接口转发\" class=\"headerlink\" title=\"4 跨接口转发\"></a>4 跨接口转发</h2><ul>\n<li>将Windows下Wireguard网络接口级别设置为<code>Private</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Set-NetConnectionProfile -InterfaceAlias <span class=\"string\">&quot;%WG_INTERFACE%&quot;</span> -NetworkCategory Private</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启用NAT转发Wireguard流量到别的接口</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">New-NetNat -Name <span class=\"string\">&quot;WG-NAT&quot;</span> -InternalIPInterfaceAddressPrefix %WG_ALL_IPS%</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>等价于以下Linux命令</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -t nat -A POSTROUTING -s %WG_ALL_IPS% -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure>\n\n<span class='p center h1 black'>欢迎查看我的项目 fast_fullmesh</span>\n\n<p>WGDashboard 插件,用于自动生成 WireGuard 配置(Half Mesh),客户端主动订阅配置,集中管理。</p>\n<a class=\"ghcard\" rel=\"external nofollow noopener noreferrer\" href=\"https://github.com/xinghenLuyus/fast_fullmesh\"><img src=\"https://github-readme-stats.vercel.app/api/pin/?username=xinghenLuyus&repo=fast_fullmesh&show_owner=true\"/></a>\n\n\n","categories":[{"name":"计算机网络","path":"api/categories/计算机网络.json"}],"tags":[{"name":"Wireguard","path":"api/tags/Wireguard.json"}]}