{"title":"åœ¨è…¾è®¯è½»é‡åº”ç”¨æœåŠ¡å™¨éƒ¨ç½²giteaå’Œrunner","slug":"2025-10-15","date":"2025-10-14T16:00:00.000Z","updated":"2025-10-15T12:48:32.378Z","comments":true,"path":"api/articles/2025-10-15.json","excerpt":null,"covers":null,"content":"<p>giteaçœŸçš„æ˜¯å¤ªè½»é‡å¥½ç”¨å•¦ï¼</p>\n<h2 id=\"1-å®‰è£…gitea\"><a href=\"#1-å®‰è£…gitea\" class=\"headerlink\" title=\"1 å®‰è£…gitea\"></a>1 å®‰è£…gitea</h2><h3 id=\"1-1-å‡†å¤‡å·¥ä½œ\"><a href=\"#1-1-å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"1.1 å‡†å¤‡å·¥ä½œ\"></a>1.1 å‡†å¤‡å·¥ä½œ</h3><ul>\n<li>æ‹¥æœ‰ä¸€å°æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ‹¥æœ‰å…¬ç½‘ip</li>\n</ul>\n<p>æˆ‘è¿™é‡Œæ˜¯é‡‡ç”¨äº†è…¾è®¯äº‘çš„è½»é‡åº”ç”¨äº‘æœåŠ¡å™¨ï¼Œä½¿ç”¨çš„Ubuntuå¹¶å®‰è£…å¥½äº†dockerã€‚è¿™é‡Œé‡‡ç”¨dockeréƒ¨ç½²ã€‚</p>\n<h3 id=\"1-2-åˆ›å»ºç›®å½•ä¸æƒé™\"><a href=\"#1-2-åˆ›å»ºç›®å½•ä¸æƒé™\" class=\"headerlink\" title=\"1.2 åˆ›å»ºç›®å½•ä¸æƒé™\"></a>1.2 åˆ›å»ºç›®å½•ä¸æƒé™</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /srv/gitea/&#123;data,config,logs&#125;</span><br><span class=\"line\">chown -R 1000:1000 /srv/gitea</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-ç¼–å†™docker-compose-yml\"><a href=\"#1-3-ç¼–å†™docker-compose-yml\" class=\"headerlink\" title=\"1.3 ç¼–å†™docker-compose.yml\"></a>1.3 ç¼–å†™<code>docker-compose.yml</code></h3><p>åœ¨ <code>/srv/gitea/</code> ç›®å½•ä¸‹åˆ›å»º <code>docker-compose.yml</code>ï¼š</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi docker-compose.yml</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæ ¹æ®è‡ªå·±çš„é…ç½®éœ€æ±‚æ›´æ”¹ã€‚è¿™é‡Œå·²ç»ä½¿ç”¨äº†é•œåƒæºã€‚</p>\n<figure class=\"highlight plaintext\"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">networks:</span><br><span class=\"line\">  gitea:</span><br><span class=\"line\">    external: false</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  gitea:</span><br><span class=\"line\">    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/gitea/gitea:1.24.3</span><br><span class=\"line\">    container_name: gitea</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - USER_UID=1000</span><br><span class=\"line\">      - USER_GID=1000</span><br><span class=\"line\">      - GITEA__server__ROOT_URL=https://gitea.xinghenluyus.cn/  #ä¿®æ”¹æˆè‡ªå·±çš„</span><br><span class=\"line\">      - GITEA__server__DOMAIN=gitea.xinghenluyus.cn             #ä¿®æ”¹æˆè‡ªå·±çš„</span><br><span class=\"line\">      - GITEA__server__SSH_DOMAIN=gitea.xinghenluyus.cn         #ä¿®æ”¹æˆè‡ªå·±çš„</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - gitea</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./gitea:/data</span><br><span class=\"line\">      - /etc/timezone:/etc/timezone:ro</span><br><span class=\"line\">      - /etc/localtime:/etc/localtime:ro</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;3000:3000&quot;  # Web æœ‰å†²çªå°±ä¿®æ”¹</span><br><span class=\"line\">      - &quot;222:22&quot;     # SSH æœ‰å†²çªå°±ä¿®æ”¹</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-4-éƒ¨ç½²å‘½ä»¤\"><a href=\"#1-4-éƒ¨ç½²å‘½ä»¤\" class=\"headerlink\" title=\"1.4 éƒ¨ç½²å‘½ä»¤\"></a>1.4 éƒ¨ç½²å‘½ä»¤</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /srv/gitea</span><br><span class=\"line\">sudo docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-5-è§£æåŸŸååˆ°æœåŠ¡å™¨\"><a href=\"#1-5-è§£æåŸŸååˆ°æœåŠ¡å™¨\" class=\"headerlink\" title=\"1.5 è§£æåŸŸååˆ°æœåŠ¡å™¨\"></a>1.5 è§£æåŸŸååˆ°æœåŠ¡å™¨</h3><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†å¼€å¯<code>HTTPS</code>ï¼Œé…åˆåå‘ä»£ç†æ— ç«¯å£é£Ÿç”¨ã€‚</p>\n<p>åœ¨åŸŸåæ§åˆ¶å°æ·»åŠ Aè§£æåˆ°æœåŠ¡å™¨ï¼Œåœ¨æœ¬åœ°ç”µè„‘æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œï¼š</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ping gitea.example.com</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœè¿”å›çš„ipæ˜¯è§£æçš„ipï¼Œè¯´æ˜è§£ææˆåŠŸã€‚</p>\n<h3 id=\"1-6-å®‰è£…-Nginx\"><a href=\"#1-6-å®‰è£…-Nginx\" class=\"headerlink\" title=\"1.6 å®‰è£… Nginx\"></a>1.6 å®‰è£… Nginx</h3><p>ç™»å½•ä½ çš„æœåŠ¡å™¨ï¼Œæ‰§è¡Œï¼š</p>\n<figure class=\"highlight plaintext\"><figcaption><span>Bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#æ›´æ–°åŒ…åˆ—è¡¨</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\"></span><br><span class=\"line\">#å®‰è£… Nginx</span><br><span class=\"line\">sudo apt install nginx -y</span><br><span class=\"line\"></span><br><span class=\"line\">#å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯</span><br><span class=\"line\">sudo systemctl start nginx</span><br><span class=\"line\">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure>\n\n<p><strong>æµ‹è¯• Nginx æ˜¯å¦æ­£å¸¸ï¼š</strong></p>\n<p>æµè§ˆå™¨è®¿é—®ï¼š<code>gitea.example.com</code>ï¼Œçœ‹åˆ°Nginxæ¬¢è¿é¡µåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚</p>\n<h3 id=\"1-7-åˆ›å»º-Nginx-é…ç½®æ–‡ä»¶-ä¸å¯ç”¨-HPPTS\"><a href=\"#1-7-åˆ›å»º-Nginx-é…ç½®æ–‡ä»¶-ä¸å¯ç”¨-HPPTS\" class=\"headerlink\" title=\"1.7 åˆ›å»º Nginx é…ç½®æ–‡ä»¶(ä¸å¯ç”¨ HPPTS)\"></a>1.7 åˆ›å»º Nginx é…ç½®æ–‡ä»¶(ä¸å¯ç”¨ HPPTS)</h3><ol>\n<li>åˆ›å»ºæ–‡ä»¶</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim /etc/nginx/sites-available/gitea.xinghenluyus.cn.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>nginx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    server_name gitea.xinghenluyus.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:3000;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    listen 443 ssl;</span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/gitea.xinghenluyus.cn/fullchain.pem;</span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/gitea.xinghenluyus.cn/privkey.pem;</span><br><span class=\"line\">    include /etc/letsencrypt/options-ssl-nginx.conf;</span><br><span class=\"line\">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name gitea.xinghenluyus.cn;</span><br><span class=\"line\">    return 301 https://$host$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>æµ‹è¯•é…ç½®</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>åº”è¯¥è¾“å‡º</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>é‡è½½Nginx</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-8-ç”³è¯·-Letâ€™s-Encrypt-è¯ä¹¦ï¼ˆCertbot-ä¼šè‡ªåŠ¨é…ç½®-HTTPSï¼‰\"><a href=\"#1-8-ç”³è¯·-Letâ€™s-Encrypt-è¯ä¹¦ï¼ˆCertbot-ä¼šè‡ªåŠ¨é…ç½®-HTTPSï¼‰\" class=\"headerlink\" title=\"1.8 ç”³è¯· Letâ€™s Encrypt è¯ä¹¦ï¼ˆCertbot ä¼šè‡ªåŠ¨é…ç½® HTTPSï¼‰\"></a>1.8 ç”³è¯· Letâ€™s Encrypt è¯ä¹¦ï¼ˆCertbot ä¼šè‡ªåŠ¨é…ç½® HTTPSï¼‰</h3><ol>\n<li>å®‰è£… Certbot</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>åˆ›å»ºéªŒè¯ç›®å½•</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /var/www/certbot</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>åˆ›å»ºéªŒè¯ç›®å½•</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d gitea.xinghenluyus.cn</span><br></pre></td></tr></table></figure>\n\n<p>æŒ‰æç¤ºæ“ä½œï¼š</p>\n<ul>\n<li><p>è¾“å…¥é‚®ç®±ï¼ˆç”¨äºå®‰å…¨é€šçŸ¥ï¼‰</p>\n</li>\n<li><p>åŒæ„æœåŠ¡æ¡æ¬¾ï¼ˆè¾“å…¥ Yï¼‰</p>\n</li>\n<li><p>æ˜¯å¦æ¥æ”¶æ¨å¹¿é‚®ä»¶ï¼Ÿè¾“å…¥ N</p>\n</li>\n<li><p>æ˜¯å¦å°† HTTP é‡å®šå‘åˆ° HTTPSï¼Ÿé€‰æ‹© 2ï¼ˆå¼ºåˆ¶é‡å®šå‘ï¼‰</p>\n</li>\n<li><p><strong>æµè§ˆå™¨æ‰“å¼€ ğŸ‘‰ <a href=\"https://gitea.xinghenluyus.cn/\">https://gitea.xinghenluyus.cn</a> ï¼Œå¦‚æœå®‰è£…è¿‡ç¨‹æ²¡é—®é¢˜ï¼Œå°±èƒ½æ­£å¸¸æ‰“å¼€giteaäº†</strong></p>\n</li>\n</ul>\n<h2 id=\"2-æœåŠ¡å™¨å®‰è£…-Gitea-Runner\"><a href=\"#2-æœåŠ¡å™¨å®‰è£…-Gitea-Runner\" class=\"headerlink\" title=\"2 æœåŠ¡å™¨å®‰è£… Gitea Runner\"></a>2 æœåŠ¡å™¨å®‰è£… Gitea Runner</h2><h3 id=\"2-1-ç”Ÿæˆé…ç½®æ–‡ä»¶\"><a href=\"#2-1-ç”Ÿæˆé…ç½®æ–‡ä»¶\" class=\"headerlink\" title=\"2.1 ç”Ÿæˆé…ç½®æ–‡ä»¶\"></a>2.1 ç”Ÿæˆé…ç½®æ–‡ä»¶</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /srv/gitea-runner</span><br><span class=\"line\">sudo touch config.yaml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --entrypoint=&quot;&quot; --rm -it \\</span><br><span class=\"line\">  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/gitea/act_runner:0.2.11 \\</span><br><span class=\"line\">  act_runner generate-config &gt; config.yaml</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-åœ¨-Gitea-ç®¡ç†åå°è·å–æ³¨å†Œ-token\"><a href=\"#2-2-åœ¨-Gitea-ç®¡ç†åå°è·å–æ³¨å†Œ-token\" class=\"headerlink\" title=\"2.2 åœ¨ Gitea ç®¡ç†åå°è·å–æ³¨å†Œ token\"></a>2.2 åœ¨ Gitea ç®¡ç†åå°è·å–æ³¨å†Œ token</h3><p>å·ä¸ªæ‡’~</p>\n<h3 id=\"2-3-ç”¨-Docker-è¿è¡Œå¹¶æ³¨å†Œ\"><a href=\"#2-3-ç”¨-Docker-è¿è¡Œå¹¶æ³¨å†Œ\" class=\"headerlink\" title=\"2.3 ç”¨ Docker è¿è¡Œå¹¶æ³¨å†Œ\"></a>2.3 ç”¨ Docker è¿è¡Œå¹¶æ³¨å†Œ</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">  -v /srv/gitea-runner/config.yaml:/config.yaml \\</span><br><span class=\"line\">  -v /var/run/docker.sock:/var/run/docker.sock \\</span><br><span class=\"line\">  -e CONFIG_FILE=/config.yaml \\</span><br><span class=\"line\">  -e GITEA_INSTANCE_URL=&quot;https://gitea.xinghenluyus.cn&quot; \\</span><br><span class=\"line\">  -e GITEA_RUNNER_REGISTRATION_TOKEN=&quot;&lt;your_token&gt;&quot; \\</span><br><span class=\"line\">  -e GITEA_RUNNER_NAME=&quot;runner-01&quot; \\</span><br><span class=\"line\">  -e GITEA_RUNNER_LABELS=&quot;linux,docker&quot; \\</span><br><span class=\"line\">  --name gitea_runner \\</span><br><span class=\"line\">  -d swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/gitea/act_runner:0.2.11</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>å†æ¬¡è¿›å…¥ç®¡ç†åå°ï¼Œrunneråº”è¯¥å·²ç»åœ¨çº¿å•¦ï¼</strong></li>\n</ul>\n<span class='p center h1 black'>åˆ°è¿™é‡Œä½ å·²ç»æˆåŠŸéƒ¨ç½²giteaå•¦ï¼</span>","more":"<p>giteaçœŸçš„æ˜¯å¤ªè½»é‡å¥½ç”¨å•¦ï¼</p>\n<h2 id=\"1-å®‰è£…gitea\"><a href=\"#1-å®‰è£…gitea\" class=\"headerlink\" title=\"1 å®‰è£…gitea\"></a>1 å®‰è£…gitea</h2><h3 id=\"1-1-å‡†å¤‡å·¥ä½œ\"><a href=\"#1-1-å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"1.1 å‡†å¤‡å·¥ä½œ\"></a>1.1 å‡†å¤‡å·¥ä½œ</h3><ul>\n<li>æ‹¥æœ‰ä¸€å°æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ‹¥æœ‰å…¬ç½‘ip</li>\n</ul>\n<p>æˆ‘è¿™é‡Œæ˜¯é‡‡ç”¨äº†è…¾è®¯äº‘çš„è½»é‡åº”ç”¨äº‘æœåŠ¡å™¨ï¼Œä½¿ç”¨çš„Ubuntuå¹¶å®‰è£…å¥½äº†dockerã€‚è¿™é‡Œé‡‡ç”¨dockeréƒ¨ç½²ã€‚</p>\n<h3 id=\"1-2-åˆ›å»ºç›®å½•ä¸æƒé™\"><a href=\"#1-2-åˆ›å»ºç›®å½•ä¸æƒé™\" class=\"headerlink\" title=\"1.2 åˆ›å»ºç›®å½•ä¸æƒé™\"></a>1.2 åˆ›å»ºç›®å½•ä¸æƒé™</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /srv/gitea/&#123;data,config,logs&#125;</span><br><span class=\"line\">chown -R 1000:1000 /srv/gitea</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-ç¼–å†™docker-compose-yml\"><a href=\"#1-3-ç¼–å†™docker-compose-yml\" class=\"headerlink\" title=\"1.3 ç¼–å†™docker-compose.yml\"></a>1.3 ç¼–å†™<code>docker-compose.yml</code></h3><p>åœ¨ <code>/srv/gitea/</code> ç›®å½•ä¸‹åˆ›å»º <code>docker-compose.yml</code>ï¼š</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi docker-compose.yml</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæ ¹æ®è‡ªå·±çš„é…ç½®éœ€æ±‚æ›´æ”¹ã€‚è¿™é‡Œå·²ç»ä½¿ç”¨äº†é•œåƒæºã€‚</p>\n<figure class=\"highlight plaintext\"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">networks:</span><br><span class=\"line\">  gitea:</span><br><span class=\"line\">    external: false</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  gitea:</span><br><span class=\"line\">    image: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/gitea/gitea:1.24.3</span><br><span class=\"line\">    container_name: gitea</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - USER_UID=1000</span><br><span class=\"line\">      - USER_GID=1000</span><br><span class=\"line\">      - GITEA__server__ROOT_URL=https://gitea.xinghenluyus.cn/  #ä¿®æ”¹æˆè‡ªå·±çš„</span><br><span class=\"line\">      - GITEA__server__DOMAIN=gitea.xinghenluyus.cn             #ä¿®æ”¹æˆè‡ªå·±çš„</span><br><span class=\"line\">      - GITEA__server__SSH_DOMAIN=gitea.xinghenluyus.cn         #ä¿®æ”¹æˆè‡ªå·±çš„</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - gitea</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./gitea:/data</span><br><span class=\"line\">      - /etc/timezone:/etc/timezone:ro</span><br><span class=\"line\">      - /etc/localtime:/etc/localtime:ro</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;3000:3000&quot;  # Web æœ‰å†²çªå°±ä¿®æ”¹</span><br><span class=\"line\">      - &quot;222:22&quot;     # SSH æœ‰å†²çªå°±ä¿®æ”¹</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-4-éƒ¨ç½²å‘½ä»¤\"><a href=\"#1-4-éƒ¨ç½²å‘½ä»¤\" class=\"headerlink\" title=\"1.4 éƒ¨ç½²å‘½ä»¤\"></a>1.4 éƒ¨ç½²å‘½ä»¤</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /srv/gitea</span><br><span class=\"line\">sudo docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-5-è§£æåŸŸååˆ°æœåŠ¡å™¨\"><a href=\"#1-5-è§£æåŸŸååˆ°æœåŠ¡å™¨\" class=\"headerlink\" title=\"1.5 è§£æåŸŸååˆ°æœåŠ¡å™¨\"></a>1.5 è§£æåŸŸååˆ°æœåŠ¡å™¨</h3><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†å¼€å¯<code>HTTPS</code>ï¼Œé…åˆåå‘ä»£ç†æ— ç«¯å£é£Ÿç”¨ã€‚</p>\n<p>åœ¨åŸŸåæ§åˆ¶å°æ·»åŠ Aè§£æåˆ°æœåŠ¡å™¨ï¼Œåœ¨æœ¬åœ°ç”µè„‘æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œï¼š</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ping gitea.example.com</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœè¿”å›çš„ipæ˜¯è§£æçš„ipï¼Œè¯´æ˜è§£ææˆåŠŸã€‚</p>\n<h3 id=\"1-6-å®‰è£…-Nginx\"><a href=\"#1-6-å®‰è£…-Nginx\" class=\"headerlink\" title=\"1.6 å®‰è£… Nginx\"></a>1.6 å®‰è£… Nginx</h3><p>ç™»å½•ä½ çš„æœåŠ¡å™¨ï¼Œæ‰§è¡Œï¼š</p>\n<figure class=\"highlight plaintext\"><figcaption><span>Bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#æ›´æ–°åŒ…åˆ—è¡¨</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\"></span><br><span class=\"line\">#å®‰è£… Nginx</span><br><span class=\"line\">sudo apt install nginx -y</span><br><span class=\"line\"></span><br><span class=\"line\">#å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯</span><br><span class=\"line\">sudo systemctl start nginx</span><br><span class=\"line\">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure>\n\n<p><strong>æµ‹è¯• Nginx æ˜¯å¦æ­£å¸¸ï¼š</strong></p>\n<p>æµè§ˆå™¨è®¿é—®ï¼š<code>gitea.example.com</code>ï¼Œçœ‹åˆ°Nginxæ¬¢è¿é¡µåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚</p>\n<h3 id=\"1-7-åˆ›å»º-Nginx-é…ç½®æ–‡ä»¶-ä¸å¯ç”¨-HPPTS\"><a href=\"#1-7-åˆ›å»º-Nginx-é…ç½®æ–‡ä»¶-ä¸å¯ç”¨-HPPTS\" class=\"headerlink\" title=\"1.7 åˆ›å»º Nginx é…ç½®æ–‡ä»¶(ä¸å¯ç”¨ HPPTS)\"></a>1.7 åˆ›å»º Nginx é…ç½®æ–‡ä»¶(ä¸å¯ç”¨ HPPTS)</h3><ol>\n<li>åˆ›å»ºæ–‡ä»¶</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim /etc/nginx/sites-available/gitea.xinghenluyus.cn.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>nginx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    server_name gitea.xinghenluyus.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:3000;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    listen 443 ssl;</span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/gitea.xinghenluyus.cn/fullchain.pem;</span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/gitea.xinghenluyus.cn/privkey.pem;</span><br><span class=\"line\">    include /etc/letsencrypt/options-ssl-nginx.conf;</span><br><span class=\"line\">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name gitea.xinghenluyus.cn;</span><br><span class=\"line\">    return 301 https://$host$request_uri;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>æµ‹è¯•é…ç½®</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>åº”è¯¥è¾“å‡º</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>é‡è½½Nginx</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-8-ç”³è¯·-Letâ€™s-Encrypt-è¯ä¹¦ï¼ˆCertbot-ä¼šè‡ªåŠ¨é…ç½®-HTTPSï¼‰\"><a href=\"#1-8-ç”³è¯·-Letâ€™s-Encrypt-è¯ä¹¦ï¼ˆCertbot-ä¼šè‡ªåŠ¨é…ç½®-HTTPSï¼‰\" class=\"headerlink\" title=\"1.8 ç”³è¯· Letâ€™s Encrypt è¯ä¹¦ï¼ˆCertbot ä¼šè‡ªåŠ¨é…ç½® HTTPSï¼‰\"></a>1.8 ç”³è¯· Letâ€™s Encrypt è¯ä¹¦ï¼ˆCertbot ä¼šè‡ªåŠ¨é…ç½® HTTPSï¼‰</h3><ol>\n<li>å®‰è£… Certbot</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>åˆ›å»ºéªŒè¯ç›®å½•</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /var/www/certbot</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>åˆ›å»ºéªŒè¯ç›®å½•</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d gitea.xinghenluyus.cn</span><br></pre></td></tr></table></figure>\n\n<p>æŒ‰æç¤ºæ“ä½œï¼š</p>\n<ul>\n<li><p>è¾“å…¥é‚®ç®±ï¼ˆç”¨äºå®‰å…¨é€šçŸ¥ï¼‰</p>\n</li>\n<li><p>åŒæ„æœåŠ¡æ¡æ¬¾ï¼ˆè¾“å…¥ Yï¼‰</p>\n</li>\n<li><p>æ˜¯å¦æ¥æ”¶æ¨å¹¿é‚®ä»¶ï¼Ÿè¾“å…¥ N</p>\n</li>\n<li><p>æ˜¯å¦å°† HTTP é‡å®šå‘åˆ° HTTPSï¼Ÿé€‰æ‹© 2ï¼ˆå¼ºåˆ¶é‡å®šå‘ï¼‰</p>\n</li>\n<li><p><strong>æµè§ˆå™¨æ‰“å¼€ ğŸ‘‰ <a href=\"https://gitea.xinghenluyus.cn/\">https://gitea.xinghenluyus.cn</a> ï¼Œå¦‚æœå®‰è£…è¿‡ç¨‹æ²¡é—®é¢˜ï¼Œå°±èƒ½æ­£å¸¸æ‰“å¼€giteaäº†</strong></p>\n</li>\n</ul>\n<h2 id=\"2-æœåŠ¡å™¨å®‰è£…-Gitea-Runner\"><a href=\"#2-æœåŠ¡å™¨å®‰è£…-Gitea-Runner\" class=\"headerlink\" title=\"2 æœåŠ¡å™¨å®‰è£… Gitea Runner\"></a>2 æœåŠ¡å™¨å®‰è£… Gitea Runner</h2><h3 id=\"2-1-ç”Ÿæˆé…ç½®æ–‡ä»¶\"><a href=\"#2-1-ç”Ÿæˆé…ç½®æ–‡ä»¶\" class=\"headerlink\" title=\"2.1 ç”Ÿæˆé…ç½®æ–‡ä»¶\"></a>2.1 ç”Ÿæˆé…ç½®æ–‡ä»¶</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /srv/gitea-runner</span><br><span class=\"line\">sudo touch config.yaml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --entrypoint=&quot;&quot; --rm -it \\</span><br><span class=\"line\">  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/gitea/act_runner:0.2.11 \\</span><br><span class=\"line\">  act_runner generate-config &gt; config.yaml</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-åœ¨-Gitea-ç®¡ç†åå°è·å–æ³¨å†Œ-token\"><a href=\"#2-2-åœ¨-Gitea-ç®¡ç†åå°è·å–æ³¨å†Œ-token\" class=\"headerlink\" title=\"2.2 åœ¨ Gitea ç®¡ç†åå°è·å–æ³¨å†Œ token\"></a>2.2 åœ¨ Gitea ç®¡ç†åå°è·å–æ³¨å†Œ token</h3><p>å·ä¸ªæ‡’~</p>\n<h3 id=\"2-3-ç”¨-Docker-è¿è¡Œå¹¶æ³¨å†Œ\"><a href=\"#2-3-ç”¨-Docker-è¿è¡Œå¹¶æ³¨å†Œ\" class=\"headerlink\" title=\"2.3 ç”¨ Docker è¿è¡Œå¹¶æ³¨å†Œ\"></a>2.3 ç”¨ Docker è¿è¡Œå¹¶æ³¨å†Œ</h3><figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">  -v /srv/gitea-runner/config.yaml:/config.yaml \\</span><br><span class=\"line\">  -v /var/run/docker.sock:/var/run/docker.sock \\</span><br><span class=\"line\">  -e CONFIG_FILE=/config.yaml \\</span><br><span class=\"line\">  -e GITEA_INSTANCE_URL=&quot;https://gitea.xinghenluyus.cn&quot; \\</span><br><span class=\"line\">  -e GITEA_RUNNER_REGISTRATION_TOKEN=&quot;&lt;your_token&gt;&quot; \\</span><br><span class=\"line\">  -e GITEA_RUNNER_NAME=&quot;runner-01&quot; \\</span><br><span class=\"line\">  -e GITEA_RUNNER_LABELS=&quot;linux,docker&quot; \\</span><br><span class=\"line\">  --name gitea_runner \\</span><br><span class=\"line\">  -d swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/gitea/act_runner:0.2.11</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>å†æ¬¡è¿›å…¥ç®¡ç†åå°ï¼Œrunneråº”è¯¥å·²ç»åœ¨çº¿å•¦ï¼</strong></li>\n</ul>\n<span class='p center h1 black'>åˆ°è¿™é‡Œä½ å·²ç»æˆåŠŸéƒ¨ç½²giteaå•¦ï¼</span>","categories":[{"name":"ç¼–ç¨‹ä¹‹å¤–","path":"api/categories/ç¼–ç¨‹ä¹‹å¤–.json"}],"tags":[{"name":"æ•™ç¨‹","path":"api/tags/æ•™ç¨‹.json"}]}