{"title":"Windows作为Wireguard server多端异地组网解决方案","slug":"2025-8-5","date":"2025-08-04T16:00:00.000Z","updated":"2025-08-18T06:10:01.471Z","comments":true,"path":"api/articles/2025-8-5.json","excerpt":null,"covers":["https://bu.dusays.com/2025/08/05/6891a188e688c.png","https://bu.dusays.com/2025/08/05/6891a31690077.png","https://bu.dusays.com/2025/08/05/6891a55ac9a01.png","https://bu.dusays.com/2025/08/05/6891a87df2314.png","https://bu.dusays.com/2025/08/05/6891aa2a43cc9.png"],"content":"<h2 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1 前言\"></a>1 前言</h2><h3 id=\"1-1-背景\"><a href=\"#1-1-背景\" class=\"headerlink\" title=\"1.1 背景\"></a>1.1 背景</h3><p>随着技术的不断革新，个人服务器算力和性能越来越强大，在家部署一台性能不错的主机，然后使用轻薄本远程办公逐渐成为一种解决方案。<br>奈何ip受限，稀少的ipv4地址，复杂的NAT网关，使得公网对局域网的访问难上加难。就算使用<code>Natter</code>加上<code>DDNS</code>临时动态拿到公网ip，难道你想你的电脑<code>远程端口</code>或者<code>ssh端口</code>直接暴露在公网上吗？对此<code>SakuraFRP</code>，<code>向日葵</code>，<code>ToDesk</code>各自给出了不同的解决方案。</p>\n<div class=\"note \"><p>这里重点推荐SakuraFrp，通过内网穿透和端口加密给出了不错的解决方案，对公网暴露设备端口并加密，而且不受NAT限制。另外两款远程软件适合临时控制或者备用检修通道，商用型强广告多，不适合长期使用</p></div>\n\n<p>虽然<code>SakuraFrp</code>功能强大而且价格便宜(临时使用基本免费)，但是所有流量都要到Sakura服务器转发，带宽受限。而且随着设备的变多，错综复杂的穿透隧道让配置和部署变得极其麻烦，点对点的穿透解决方案是不可行的。</p>\n<p>这时，完美的解决方案出现了 —&gt; <strong>Wireguard</strong></p>\n<h3 id=\"1-2-Wireguard介绍\"><a href=\"#1-2-Wireguard介绍\" class=\"headerlink\" title=\"1.2 Wireguard介绍\"></a>1.2 Wireguard介绍</h3><p>WireGuard 是一种现代化的、简化的、安全的VPN（虚拟私人网络）协议。以下是对其特点及工作原理的详细介绍：</p>\n<ul>\n<li>简洁性：WireGuard 的设计目标之一是简化配置和部署，其代码库远小于其他如 OpenVPN 和 IPSec 等解决方案。</li>\n<li>性能：由于其精简的设计和对最新加密技术的应用，WireGuard 速度更快、延迟更低。</li>\n<li>WireGuard 使用最先进的加密算法，确保数据传输的安全性。</li>\n<li>WireGuard 可以在多种平台上运行，包括 Linux、Windows、macOS、iOS、Android 等，支持跨平台使用，同时其简单的配置流程也降低了用户的使用门槛。</li>\n<li>通过 UDP 协议进行通信，WireGuard 能够更好地适应网络条件的变化，并且具有自动重连功能，保证连接的稳定性和可靠性。</li>\n<li>与传统VPN不同的是，WireGuard 支持客户端使用动态IP地址，<code>无需固定IP地址即可建立稳定的连接</code>，且兼容<code>ipv4</code>和<code>ipv6</code>。</li>\n</ul>\n<p>使用WireGuard，我们可以将所有想要直接关联的设备通过安全隧道连接起来，形成一个<strong>虚拟的专用网络</strong>，可以像局域网一样轻松访问和管理内网设备。</p>\n<h3 id=\"1-3-为什么我选择Windows作为终端server？\"><a href=\"#1-3-为什么我选择Windows作为终端server？\" class=\"headerlink\" title=\"1.3 为什么我选择Windows作为终端server？\"></a>1.3 为什么我选择Windows作为终端server？</h3><p>最主要原因，是因为我的<code>NAS(网络附属存储)</code>不支持<code>docker(轻量级容器技术)</code>，它也就变相的不支持部署Wireguard。作为家里的第二大常驻设备，我把目光瞄准到了我的PC。虽然Windows的系统使它注定无法24小时开机，但是<code>Wake On LAN(局域网唤醒)</code>完美的弥补了这一点。想要组网时，我远程唤醒PC开机即可。<br>至于为什么不把设备刷成Linux，我只能说它不止是一台server，还有别的作用(剪辑、设计、游戏)。而且使用<code>wsl2+docker</code>，上面完全可以部署我的服务，充当服务器的作用。</p>\n<h2 id=\"2-部署\"><a href=\"#2-部署\" class=\"headerlink\" title=\"2 部署\"></a>2 部署</h2><h3 id=\"2-1-网络环境\"><a href=\"#2-1-网络环境\" class=\"headerlink\" title=\"2.1 网络环境\"></a>2.1 网络环境</h3><ul>\n<li>对于有公网ip地址的，配置路由器的端口转发即可。</li>\n<li>对于ipv4，在NAT1的环境下，邪修使用<code>Natter</code>可以拿到临时公网ip。(UDP在ipv4环境跨区丢包很严重，这里不推荐没有公网ip的使用)</li>\n<li>对于ipv6，尽量保证server环境处于NAT1，使用<code>DDNS-GO</code>可以将拿到的动态ipv6通过域名解析绑定到某个域名，从而实现稳定的使用。<a href=\"https://github.com/jeessy2/ddns-go\">点我传送到DDNS-GO</a></li>\n</ul>\n<p>请注意：用路由器给server<code>分配固定ip</code>并开启<code>DMZ主机</code>，确保网络环境的稳定性。</p>\n<h3 id=\"2-2-一键部署\"><a href=\"#2-2-一键部署\" class=\"headerlink\" title=\"2.2 一键部署\"></a>2.2 一键部署</h3><p>Windows下想要完全启用Wireguard的功能，需要更改众多配置。好在已经有前人帮我们早好了轮子<a href=\"https://github.com/micahmo/WgServerforWindows\">Wg Server for Windows</a>，我们直接拿来用即可。</p>\n<div class=\"timeline\">\n<div class=\"timenode\"><div class=\"meta\"><p><p>1.工具下载</p>\n</p></div><div class=\"body\"><p>从<a href=\"https://github.com/micahmo/WgServerforWindows/releases\">releases</a>下载WS4W最新版本。我的版本是2.1.4。<br>安装完成后得到如下界面：</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/05/6891a188e688c.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/05/6891a188e688c.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"WS4W界面图\"/></div><span class=\"image-caption\">WS4W界面图</span></div></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>2.下载Wireguard</p>\n</p></div><div class=\"body\"><p>点击<code>Download and install Wireguard</code>，根据指引一键自动下载安装。</p></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>3.配置Server</p>\n</p></div><div class=\"body\"><p>点击<code>Edit server configuration</code>，进入server配置页面。</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/05/6891a31690077.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/05/6891a31690077.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"server配置页\"/></div><span class=\"image-caption\">server配置页</span></div><p>其中<code>Endpoint</code>填写<code>ip:端口(和Listen Port一致)</code>，ip全面支持ipv4，ipv6，域名。两个<code>Key</code>点击<code>Generate</code>自动生成。其余配置照抄即可，这里不过多赘述。</p></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>3.配置clients(Server端)</p>\n</p></div><div class=\"body\"><p>点击<code>Configure client</code>，进入client配置页面。</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/05/6891a55ac9a01.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/05/6891a55ac9a01.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"client配置页\"/></div><span class=\"image-caption\">client配置页</span></div><ol><li>点击<code>Add Client</code>，会弹出类似上图的界面。</li><li>配置客户端信息，大部分可以直接<code>Generate</code>自动生成。要注意的是<code>Allowed IPs</code>配置每个客户端通过Wireguard的流量。在这里配置的所有ip段的流量都会被导向<code>Wireguard server</code>。比如我的配置中，除了<code>Address</code>流量，还有<code>192.168.0网段</code>的所有流量都会导向<code>Wireguard Server</code>转发。我这样配置不仅可以让虚拟局域网内设备相互关联，还可以从Client访问Server所在局域网。</li><li>点击<code>Export configuration File</code>可以生成一个文件供客户端使用。手机端还可以直接生成二维码。</li><li>点击<code>Save</code>保存。</li></ol></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>4.配置clients(客户端)</p>\n</p></div><div class=\"body\"><p>客户端下载<a href=\"https://www.wireguard.com/install/\">Wireguard</a>，导入生成的那个文件直接应用配置即可。</p><p>以Windows为例，配置文件应该如下所示：</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/05/6891a87df2314.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/05/6891a87df2314.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"Windows配置\"/></div><span class=\"image-caption\">Windows配置</span></div><p><strong>注意</strong>：将<code>AllowedIPs</code>中的<code>10.8.0.X/32</code>修改成整个网段，即<code>10.8.0.0/24</code>。</p></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>5.Server剩余配置</p>\n</p></div><div class=\"body\"><p>依次点击<code>Install tunnel service</code>，<code>Make private</code>，<code>Enable NAT</code>，完成剩余配置。成功后界面如下：</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/05/6891aa2a43cc9.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/05/6891aa2a43cc9.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"成功配置\"/></div><span class=\"image-caption\">成功配置</span></div></div></div>\n</div>\n\n<p>不出意外的话到这里为止部署就成功了。WS4W只是一个配置工具，关闭即可，真正的配置已经落实到Windows的各个角落。</p>\n<h2 id=\"3-一些细节收尾\"><a href=\"#3-一些细节收尾\" class=\"headerlink\" title=\"3 一些细节收尾\"></a>3 一些细节收尾</h2><h3 id=\"3-1-在-Windows-上启用路由功能\"><a href=\"#3-1-在-Windows-上启用路由功能\" class=\"headerlink\" title=\"3.1 在 Windows 上启用路由功能\"></a>3.1 在 Windows 上启用路由功能</h3><ul>\n<li>启用路由功能模拟端口转发，实现节点间通信</li>\n</ul>\n<figure class=\"highlight plaintext\"><figcaption><span>powershell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Set-ItemProperty -Path &quot;HKLM:\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters&quot; -Name &quot;IPEnableRouter&quot; -Value 1</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在<code>服务</code>中找到<code>Routing and Remote Access</code>，设置启动类型为自动，然后启动这个服务。</li>\n</ul>\n<h3 id=\"3-2-配置-Windows-防火墙\"><a href=\"#3-2-配置-Windows-防火墙\" class=\"headerlink\" title=\"3.2 配置 Windows 防火墙\"></a>3.2 配置 Windows 防火墙</h3><ul>\n<li>允许 ICMP 回显请求（即 ping 请求）</li>\n</ul>\n<figure class=\"highlight plaintext\"><figcaption><span>powershell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">New-NetFirewallRule -DisplayName &quot;Allow ICMPv4-In&quot; -Protocol ICMPv4 -IcmpType 8 -Enabled True -Action Allow -Profile Any</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>视情况开放Server的51820端口(如果Client不能连接)</li>\n</ul>\n<span class='p center h1 black'>到这里你的Windows已经成为Wireguard Server啦！</span>","more":"<h2 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1 前言\"></a>1 前言</h2><h3 id=\"1-1-背景\"><a href=\"#1-1-背景\" class=\"headerlink\" title=\"1.1 背景\"></a>1.1 背景</h3><p>随着技术的不断革新，个人服务器算力和性能越来越强大，在家部署一台性能不错的主机，然后使用轻薄本远程办公逐渐成为一种解决方案。<br>奈何ip受限，稀少的ipv4地址，复杂的NAT网关，使得公网对局域网的访问难上加难。就算使用<code>Natter</code>加上<code>DDNS</code>临时动态拿到公网ip，难道你想你的电脑<code>远程端口</code>或者<code>ssh端口</code>直接暴露在公网上吗？对此<code>SakuraFRP</code>，<code>向日葵</code>，<code>ToDesk</code>各自给出了不同的解决方案。</p>\n<div class=\"note \"><p>这里重点推荐SakuraFrp，通过内网穿透和端口加密给出了不错的解决方案，对公网暴露设备端口并加密，而且不受NAT限制。另外两款远程软件适合临时控制或者备用检修通道，商用型强广告多，不适合长期使用</p></div>\n\n<p>虽然<code>SakuraFrp</code>功能强大而且价格便宜(临时使用基本免费)，但是所有流量都要到Sakura服务器转发，带宽受限。而且随着设备的变多，错综复杂的穿透隧道让配置和部署变得极其麻烦，点对点的穿透解决方案是不可行的。</p>\n<p>这时，完美的解决方案出现了 —&gt; <strong>Wireguard</strong></p>\n<h3 id=\"1-2-Wireguard介绍\"><a href=\"#1-2-Wireguard介绍\" class=\"headerlink\" title=\"1.2 Wireguard介绍\"></a>1.2 Wireguard介绍</h3><p>WireGuard 是一种现代化的、简化的、安全的VPN（虚拟私人网络）协议。以下是对其特点及工作原理的详细介绍：</p>\n<ul>\n<li>简洁性：WireGuard 的设计目标之一是简化配置和部署，其代码库远小于其他如 OpenVPN 和 IPSec 等解决方案。</li>\n<li>性能：由于其精简的设计和对最新加密技术的应用，WireGuard 速度更快、延迟更低。</li>\n<li>WireGuard 使用最先进的加密算法，确保数据传输的安全性。</li>\n<li>WireGuard 可以在多种平台上运行，包括 Linux、Windows、macOS、iOS、Android 等，支持跨平台使用，同时其简单的配置流程也降低了用户的使用门槛。</li>\n<li>通过 UDP 协议进行通信，WireGuard 能够更好地适应网络条件的变化，并且具有自动重连功能，保证连接的稳定性和可靠性。</li>\n<li>与传统VPN不同的是，WireGuard 支持客户端使用动态IP地址，<code>无需固定IP地址即可建立稳定的连接</code>，且兼容<code>ipv4</code>和<code>ipv6</code>。</li>\n</ul>\n<p>使用WireGuard，我们可以将所有想要直接关联的设备通过安全隧道连接起来，形成一个<strong>虚拟的专用网络</strong>，可以像局域网一样轻松访问和管理内网设备。</p>\n<h3 id=\"1-3-为什么我选择Windows作为终端server？\"><a href=\"#1-3-为什么我选择Windows作为终端server？\" class=\"headerlink\" title=\"1.3 为什么我选择Windows作为终端server？\"></a>1.3 为什么我选择Windows作为终端server？</h3><p>最主要原因，是因为我的<code>NAS(网络附属存储)</code>不支持<code>docker(轻量级容器技术)</code>，它也就变相的不支持部署Wireguard。作为家里的第二大常驻设备，我把目光瞄准到了我的PC。虽然Windows的系统使它注定无法24小时开机，但是<code>Wake On LAN(局域网唤醒)</code>完美的弥补了这一点。想要组网时，我远程唤醒PC开机即可。<br>至于为什么不把设备刷成Linux，我只能说它不止是一台server，还有别的作用(剪辑、设计、游戏)。而且使用<code>wsl2+docker</code>，上面完全可以部署我的服务，充当服务器的作用。</p>\n<h2 id=\"2-部署\"><a href=\"#2-部署\" class=\"headerlink\" title=\"2 部署\"></a>2 部署</h2><h3 id=\"2-1-网络环境\"><a href=\"#2-1-网络环境\" class=\"headerlink\" title=\"2.1 网络环境\"></a>2.1 网络环境</h3><ul>\n<li>对于有公网ip地址的，配置路由器的端口转发即可。</li>\n<li>对于ipv4，在NAT1的环境下，邪修使用<code>Natter</code>可以拿到临时公网ip。(UDP在ipv4环境跨区丢包很严重，这里不推荐没有公网ip的使用)</li>\n<li>对于ipv6，尽量保证server环境处于NAT1，使用<code>DDNS-GO</code>可以将拿到的动态ipv6通过域名解析绑定到某个域名，从而实现稳定的使用。<a href=\"https://github.com/jeessy2/ddns-go\">点我传送到DDNS-GO</a></li>\n</ul>\n<p>请注意：用路由器给server<code>分配固定ip</code>并开启<code>DMZ主机</code>，确保网络环境的稳定性。</p>\n<h3 id=\"2-2-一键部署\"><a href=\"#2-2-一键部署\" class=\"headerlink\" title=\"2.2 一键部署\"></a>2.2 一键部署</h3><p>Windows下想要完全启用Wireguard的功能，需要更改众多配置。好在已经有前人帮我们早好了轮子<a href=\"https://github.com/micahmo/WgServerforWindows\">Wg Server for Windows</a>，我们直接拿来用即可。</p>\n<div class=\"timeline\">\n<div class=\"timenode\"><div class=\"meta\"><p><p>1.工具下载</p>\n</p></div><div class=\"body\"><p>从<a href=\"https://github.com/micahmo/WgServerforWindows/releases\">releases</a>下载WS4W最新版本。我的版本是2.1.4。<br>安装完成后得到如下界面：</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/05/6891a188e688c.png\" alt=\"WS4W界面图\"/></div><span class=\"image-caption\">WS4W界面图</span></div></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>2.下载Wireguard</p>\n</p></div><div class=\"body\"><p>点击<code>Download and install Wireguard</code>，根据指引一键自动下载安装。</p></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>3.配置Server</p>\n</p></div><div class=\"body\"><p>点击<code>Edit server configuration</code>，进入server配置页面。</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/05/6891a31690077.png\" alt=\"server配置页\"/></div><span class=\"image-caption\">server配置页</span></div><p>其中<code>Endpoint</code>填写<code>ip:端口(和Listen Port一致)</code>，ip全面支持ipv4，ipv6，域名。两个<code>Key</code>点击<code>Generate</code>自动生成。其余配置照抄即可，这里不过多赘述。</p></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>3.配置clients(Server端)</p>\n</p></div><div class=\"body\"><p>点击<code>Configure client</code>，进入client配置页面。</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/05/6891a55ac9a01.png\" alt=\"client配置页\"/></div><span class=\"image-caption\">client配置页</span></div><ol><li>点击<code>Add Client</code>，会弹出类似上图的界面。</li><li>配置客户端信息，大部分可以直接<code>Generate</code>自动生成。要注意的是<code>Allowed IPs</code>配置每个客户端通过Wireguard的流量。在这里配置的所有ip段的流量都会被导向<code>Wireguard server</code>。比如我的配置中，除了<code>Address</code>流量，还有<code>192.168.0网段</code>的所有流量都会导向<code>Wireguard Server</code>转发。我这样配置不仅可以让虚拟局域网内设备相互关联，还可以从Client访问Server所在局域网。</li><li>点击<code>Export configuration File</code>可以生成一个文件供客户端使用。手机端还可以直接生成二维码。</li><li>点击<code>Save</code>保存。</li></ol></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>4.配置clients(客户端)</p>\n</p></div><div class=\"body\"><p>客户端下载<a href=\"https://www.wireguard.com/install/\">Wireguard</a>，导入生成的那个文件直接应用配置即可。</p><p>以Windows为例，配置文件应该如下所示：</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/05/6891a87df2314.png\" alt=\"Windows配置\"/></div><span class=\"image-caption\">Windows配置</span></div><p><strong>注意</strong>：将<code>AllowedIPs</code>中的<code>10.8.0.X/32</code>修改成整个网段，即<code>10.8.0.0/24</code>。</p></div></div>\n\n<div class=\"timenode\"><div class=\"meta\"><p><p>5.Server剩余配置</p>\n</p></div><div class=\"body\"><p>依次点击<code>Install tunnel service</code>，<code>Make private</code>，<code>Enable NAT</code>，完成剩余配置。成功后界面如下：</p><div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/05/6891aa2a43cc9.png\" alt=\"成功配置\"/></div><span class=\"image-caption\">成功配置</span></div></div></div>\n</div>\n\n<p>不出意外的话到这里为止部署就成功了。WS4W只是一个配置工具，关闭即可，真正的配置已经落实到Windows的各个角落。</p>\n<h2 id=\"3-一些细节收尾\"><a href=\"#3-一些细节收尾\" class=\"headerlink\" title=\"3 一些细节收尾\"></a>3 一些细节收尾</h2><h3 id=\"3-1-在-Windows-上启用路由功能\"><a href=\"#3-1-在-Windows-上启用路由功能\" class=\"headerlink\" title=\"3.1 在 Windows 上启用路由功能\"></a>3.1 在 Windows 上启用路由功能</h3><ul>\n<li>启用路由功能模拟端口转发，实现节点间通信</li>\n</ul>\n<figure class=\"highlight plaintext\"><figcaption><span>powershell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Set-ItemProperty -Path &quot;HKLM:\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters&quot; -Name &quot;IPEnableRouter&quot; -Value 1</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在<code>服务</code>中找到<code>Routing and Remote Access</code>，设置启动类型为自动，然后启动这个服务。</li>\n</ul>\n<h3 id=\"3-2-配置-Windows-防火墙\"><a href=\"#3-2-配置-Windows-防火墙\" class=\"headerlink\" title=\"3.2 配置 Windows 防火墙\"></a>3.2 配置 Windows 防火墙</h3><ul>\n<li>允许 ICMP 回显请求（即 ping 请求）</li>\n</ul>\n<figure class=\"highlight plaintext\"><figcaption><span>powershell</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">New-NetFirewallRule -DisplayName &quot;Allow ICMPv4-In&quot; -Protocol ICMPv4 -IcmpType 8 -Enabled True -Action Allow -Profile Any</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>视情况开放Server的51820端口(如果Client不能连接)</li>\n</ul>\n<span class='p center h1 black'>到这里你的Windows已经成为Wireguard Server啦！</span>","categories":[{"name":"计算机网络","path":"api/categories/计算机网络.json"}],"tags":[{"name":"异地组网","path":"api/tags/异地组网.json"}]}