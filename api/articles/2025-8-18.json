{"title":"如何在Volantis-5主题上使用artalk评论系统(同本站)","slug":"2025-8-18","date":"2025-08-18T03:05:51.206Z","updated":"2025-08-18T05:59:23.408Z","comments":true,"path":"api/articles/2025-8-18.json","excerpt":null,"covers":["https://bu.dusays.com/2025/08/18/68a2aba5148d8.png","https://bu.dusays.com/2025/08/18/68a2b864ea899.png","https://bu.dusays.com/2025/08/18/68a2bc7003aa2.png","https://bu.dusays.com/2025/08/18/68a2c066e9085.png"],"content":"<p>artalk以私有化部署实现数据自控与极速响应，社交登录、邮件通知、Markdown 等功能开箱即用。话不多说，下面直接上教程。</p>\n<p>这里我犯了很多错一直走回头路，一个配置反复折腾，以下是最简步骤。</p>\n<h2 id=\"1-在服务端配置-Nginx\"><a href=\"#1-在服务端配置-Nginx\" class=\"headerlink\" title=\"1 在服务端配置 Nginx\"></a>1 在服务端配置 Nginx</h2><h3 id=\"1-1-准备工作\"><a href=\"#1-1-准备工作\" class=\"headerlink\" title=\"1.1 准备工作\"></a>1.1 准备工作</h3><ul>\n<li>拥有一台服务器，并且拥有公网ip</li>\n</ul>\n<p>我这里是采用了腾讯云的轻量应用云服务器，使用的Ubuntu并安装好了docker。这里采用docker部署。</p>\n<h3 id=\"1-2-解析域名到服务器\"><a href=\"#1-2-解析域名到服务器\" class=\"headerlink\" title=\"1.2 解析域名到服务器\"></a>1.2 解析域名到服务器</h3><p>这一步主要是为了开启<code>HTTPS</code>，如果是动态ip，还可以配合<code>DDNS</code>动态解析域名。</p>\n<p>推荐使用<code>artalk.example.com</code>这样的子域名格式，域名可以和博客网站保持一致，简化备案流程。</p>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/18/68a2aba5148d8.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/18/68a2aba5148d8.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"域名解析\"/></div><span class=\"image-caption\">域名解析</span></div>\n\n<p>在本地电脑打开终端，运行：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ping artalk.example.com</span><br></pre></td></tr></table></figure>\n\n<p>如果返回的ip是解析的ip，说明解析成功。</p>\n<h3 id=\"1-3-安装-Nginx\"><a href=\"#1-3-安装-Nginx\" class=\"headerlink\" title=\"1.3 安装 Nginx\"></a>1.3 安装 Nginx</h3><p>登录你的服务器，执行：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>Bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 更新包列表</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装 Nginx</span><br><span class=\"line\">sudo apt install nginx -y</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动并设置开机自启</span><br><span class=\"line\">sudo systemctl start nginx</span><br><span class=\"line\">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure>\n\n<p><strong>测试 Nginx 是否正常：</strong></p>\n<p>浏览器访问：<code>artalk.example.com</code>，看到Nginx欢迎页则说明安装成功。</p>\n<h3 id=\"1-4-创建-Nginx-配置文件-不启用-HPPTS\"><a href=\"#1-4-创建-Nginx-配置文件-不启用-HPPTS\" class=\"headerlink\" title=\"1.4 创建 Nginx 配置文件(不启用 HPPTS)\"></a>1.4 创建 Nginx 配置文件(不启用 HPPTS)</h3><ol>\n<li>创建文件</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/nginx/sites-available/artalk.xinghenluyus.cn.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>nginx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name artalk.xinghenluyus.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">    # Certbot 验证路径</span><br><span class=\"line\">    location /.well-known/acme-challenge/ &#123;</span><br><span class=\"line\">        root /var/www/certbot;</span><br><span class=\"line\">        try_files $uri =404;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 其他请求先不重定向（或可重定向，但不能 listen 443）</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        # 可选：先不重定向，等证书申请完再开启</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:8080;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Port $server_port;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Host $host;</span><br><span class=\"line\"></span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>测试配置</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>应该输出</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>重载Nginx</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-5-申请-Let’s-Encrypt-证书（Certbot-会自动配置-HTTPS）\"><a href=\"#1-5-申请-Let’s-Encrypt-证书（Certbot-会自动配置-HTTPS）\" class=\"headerlink\" title=\"1.5 申请 Let’s Encrypt 证书（Certbot 会自动配置 HTTPS）\"></a>1.5 申请 Let’s Encrypt 证书（Certbot 会自动配置 HTTPS）</h3><ol>\n<li>安装 Certbot</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>创建验证目录</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /var/www/certbot</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>创建验证目录</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d artalk.xinghenluyus.cn</span><br></pre></td></tr></table></figure>\n\n<p>按提示操作：</p>\n<ul>\n<li>输入邮箱（用于安全通知）</li>\n<li>同意服务条款（输入 Y）</li>\n<li>是否接收推广邮件？输入 N</li>\n<li>是否将 HTTP 重定向到 HTTPS？选择 2（强制重定向）</li>\n</ul>\n<h2 id=\"2-服务器安装-Artalk\"><a href=\"#2-服务器安装-Artalk\" class=\"headerlink\" title=\"2 服务器安装 Artalk\"></a>2 服务器安装 Artalk</h2><h3 id=\"2-1-程序部署\"><a href=\"#2-1-程序部署\" class=\"headerlink\" title=\"2.1 程序部署\"></a>2.1 程序部署</h3><p>执行命令在后台启动容器：</p>\n<p><em>请注意<code>ATK_SITE_DEFAULT</code>改成你的网站title(对应<code>_config.yml</code>文件中title)，<code>ATK_SITE_URL</code>改成服务器实际解析域名。</em></p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">    --name artalk \\</span><br><span class=\"line\">    -p 8080:23366 \\</span><br><span class=\"line\">    -v $(pwd)/data:/data \\</span><br><span class=\"line\">    -e &quot;TZ=Asia/Shanghai&quot; \\</span><br><span class=\"line\">    -e &quot;ATK_LOCALE=zh-CN&quot; \\</span><br><span class=\"line\">    -e &quot;ATK_SITE_DEFAULT=Artalk 的博客&quot; \\</span><br><span class=\"line\">    -e &quot;ATK_SITE_URL=https://artalk.example.com&quot; \\</span><br><span class=\"line\">    artalk/artalk-go</span><br></pre></td></tr></table></figure>\n\n<p>执行命令创建管理员账户：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it artalk artalk admin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-进入后台\"><a href=\"#2-2-进入后台\" class=\"headerlink\" title=\"2.2 进入后台\"></a>2.2 进入后台</h3><p>主机浏览器输入 <code>https://artalk.example.com</code> 进入 Artalk 后台登录界面。</p>\n<p><strong>如果这这一步不成功，自行在 1.4, 1.5, 2.1 之间排查原因。</strong></p>\n<h3 id=\"2-3-配置可信域名\"><a href=\"#2-3-配置可信域名\" class=\"headerlink\" title=\"2.3 配置可信域名\"></a>2.3 配置可信域名</h3><p>登录后台 -&gt; 设置 -&gt; 可信域名</p>\n<p>将你的博客域名 (<em>也就是要使用这个评论系统页面的所有域名</em>) 都添加到可信域名列表中，解决CORS报错。然后点击右下角<code>应用</code>。</p>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/18/68a2b864ea899.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/18/68a2b864ea899.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"配置示例\"/></div><span class=\"image-caption\">配置示例</span></div>\n\n<h2 id=\"3-Volantis-配置-Artalk\"><a href=\"#3-Volantis-配置-Artalk\" class=\"headerlink\" title=\"3 Volantis 配置 Artalk\"></a>3 Volantis 配置 Artalk</h2><p>打开<code>_config.volantis.yml</code>文件，添加artalk相关配置</p>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/18/68a2bc7003aa2.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/18/68a2bc7003aa2.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"_config.volantis.yml相关配置\"/></div><span class=\"image-caption\">_config.volantis.yml相关配置</span></div>\n\n<p>如果你的<code>Volantis</code>版本是<code>5.8.0</code>，则对于新版Artalk也就是2.9.1,<strong>浏览器会弹出pjax错误</strong>。</p>\n<p>这时有两个解决方案：</p>\n<ol>\n<li>如果你是通过npm安装的，可以打开<code>node_modules\\hexo-theme-volantis\\layout\\_plugins\\comments\\artalk\\script.ejs</code>，用下面代码替换源码。(记得做好备份工作)</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>script.ejs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  volantis.layoutHelper(&quot;comments&quot;, `&lt;div id=&quot;artalk_container&quot;&gt;&lt;i class=&quot;fa-solid fa-cog fa-spin fa-fw fa-2x&quot;&gt;&lt;/i&gt;&lt;/div&gt;`);</span><br><span class=\"line\"></span><br><span class=\"line\">  function load_artalk() &#123;</span><br><span class=\"line\">    if (!document.querySelector(&quot;#artalk_container&quot;)) return;</span><br><span class=\"line\"></span><br><span class=\"line\">    volantis.css(&quot;&lt;%- theme.comments.artalk.css %&gt;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    volantis.js(&quot;&lt;%- theme.comments.artalk.js %&gt;&quot;)</span><br><span class=\"line\">      .then(() =&gt; &#123;</span><br><span class=\"line\">        if (typeof Artalk === &#x27;undefined&#x27;) &#123;</span><br><span class=\"line\">          console.error(&#x27;Artalk.js loaded but Artalk is not defined&#x27;);</span><br><span class=\"line\">          return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return pjax_artalk();</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .catch(err =&gt; &#123;</span><br><span class=\"line\">        console.error(&#x27;Failed to load Artalk.js:&#x27;, err);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  function pjax_artalk() &#123;</span><br><span class=\"line\">    if (!document.querySelector(&quot;#artalk_container&quot;)) return;</span><br><span class=\"line\"></span><br><span class=\"line\">    let path = pdata.commentPath;</span><br><span class=\"line\">    let placeholder = pdata.commentPlaceholder || &quot;&lt;%= theme.comments.artalk.placeholder %&gt;&quot; || &quot;&quot;;</span><br><span class=\"line\">    if (!path) &#123;</span><br><span class=\"line\">      path = &#x27;&lt;%= theme.comments.artalk.path %&gt;&#x27; || decodeURI(window.location.pathname);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (!&#x27;&lt;%= config.permalink %&gt;&#x27;.includes(&#x27;/index.html&#x27;)) &#123;</span><br><span class=\"line\">      path = path.replace(/\\/index\\.html$/, &#x27;/&#x27;).replace(/\\.html$/, &#x27;&#x27;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    volantis.artalk = Artalk.init(Object.assign(&lt;%- JSON.stringify(theme.comments.artalk) %&gt;, &#123;</span><br><span class=\"line\">      el: &#x27;#artalk_container&#x27;,</span><br><span class=\"line\">      pageKey: path,</span><br><span class=\"line\">      pageTitle: document.title,</span><br><span class=\"line\">      placeholder: placeholder,</span><br><span class=\"line\">      useBackendConf: true,</span><br><span class=\"line\">      site: &#x27;&lt;%= config.title %&gt;&#x27;,</span><br><span class=\"line\">      darkMode: volantis.dark.mode === &quot;dark&quot;,</span><br><span class=\"line\">      pvEl: &#x27;#artalk_visitors&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;% if(!!theme.comments.artalk.imageUploader?.api)&#123; %&gt;</span><br><span class=\"line\">      imgUploader: function(file) &#123;</span><br><span class=\"line\">        let headers = new Headers();</span><br><span class=\"line\">        headers.set(&#x27;Accept&#x27;, &#x27;application/json&#x27;);</span><br><span class=\"line\">        &lt;% if(!!theme.comments.artalk.imageUploader?.token) &#123; %&gt;</span><br><span class=\"line\">          headers.set(&#x27;Authorization&#x27;, &#x27;&lt;%= theme.comments.artalk.imageUploader?.token %&gt;&#x27;);</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">        let formData = new FormData();</span><br><span class=\"line\">        formData.append(&#x27;file&#x27;, file);</span><br><span class=\"line\">        return fetch(&#x27;&lt;%= theme.comments.artalk.imageUploader?.api %&gt;&#x27;, &#123;</span><br><span class=\"line\">          method: &#x27;POST&#x27;,</span><br><span class=\"line\">          body: formData,</span><br><span class=\"line\">          headers: headers</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(resp =&gt; resp.json())</span><br><span class=\"line\">        .then(resp =&gt; resp.&lt;%= theme.comments.artalk.imageUploader?.resp %&gt;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &lt;% &#125; %&gt;</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">    Artalk.use(ctx =&gt; &#123;</span><br><span class=\"line\">      ctx.on(&#x27;list-loaded&#x27;, () =&gt; &#123;</span><br><span class=\"line\">        if (typeof VolantisFancyBox === &quot;undefined&quot;) &#123;</span><br><span class=\"line\">          const checkFancyBox = setInterval(() =&gt; &#123;</span><br><span class=\"line\">            if (typeof VolantisFancyBox === &quot;undefined&quot;) return;</span><br><span class=\"line\">            clearInterval(checkFancyBox);</span><br><span class=\"line\">            VolantisFancyBox.groupBind(&#x27;.atk-content img:not([atk-emoticon])&#x27;, &#x27;Comments&#x27;);</span><br><span class=\"line\">          &#125;, 100);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">          VolantisFancyBox.groupBind(&#x27;.atk-content img:not([atk-emoticon])&#x27;, &#x27;Comments&#x27;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  load_artalk();</span><br><span class=\"line\"></span><br><span class=\"line\">  volantis.pjax.push(() =&gt; &#123;</span><br><span class=\"line\">    if (typeof Artalk === &quot;undefined&quot;) &#123;</span><br><span class=\"line\">      load_artalk();</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      pjax_artalk();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;, &#x27;artalk&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">  function dark_artalk() &#123;</span><br><span class=\"line\">    if (!document.querySelector(&quot;#artalk_container&quot;)) return;</span><br><span class=\"line\">    if (volantis.artalk &amp;&amp; typeof volantis.artalk.setDarkMode === &#x27;function&#x27;) &#123;</span><br><span class=\"line\">      volantis.artalk.setDarkMode(volantis.dark.mode === &quot;dark&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  volantis.dark.push(dark_artalk);</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>如果你是通过拉取仓库源码方式安装，可以拉取仓库最新的<code>dev</code>分支，我的代码已经被合并到dev分支，暂时还没作为5.8.1版本发布。</li>\n</ol>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img lazyload\" src=\"https://bu.dusays.com/2025/08/18/68a2c066e9085.png\" class=\"lazyload\" data-srcset=\"https://bu.dusays.com/2025/08/18/68a2c066e9085.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"dev分支\"/></div><span class=\"image-caption\">dev分支</span></div>\n\n\n<span class='p center h1 black'>到这里你的blog已经成功集成Artalk啦！</span>","more":"<p>artalk以私有化部署实现数据自控与极速响应，社交登录、邮件通知、Markdown 等功能开箱即用。话不多说，下面直接上教程。</p>\n<p>这里我犯了很多错一直走回头路，一个配置反复折腾，以下是最简步骤。</p>\n<h2 id=\"1-在服务端配置-Nginx\"><a href=\"#1-在服务端配置-Nginx\" class=\"headerlink\" title=\"1 在服务端配置 Nginx\"></a>1 在服务端配置 Nginx</h2><h3 id=\"1-1-准备工作\"><a href=\"#1-1-准备工作\" class=\"headerlink\" title=\"1.1 准备工作\"></a>1.1 准备工作</h3><ul>\n<li>拥有一台服务器，并且拥有公网ip</li>\n</ul>\n<p>我这里是采用了腾讯云的轻量应用云服务器，使用的Ubuntu并安装好了docker。这里采用docker部署。</p>\n<h3 id=\"1-2-解析域名到服务器\"><a href=\"#1-2-解析域名到服务器\" class=\"headerlink\" title=\"1.2 解析域名到服务器\"></a>1.2 解析域名到服务器</h3><p>这一步主要是为了开启<code>HTTPS</code>，如果是动态ip，还可以配合<code>DDNS</code>动态解析域名。</p>\n<p>推荐使用<code>artalk.example.com</code>这样的子域名格式，域名可以和博客网站保持一致，简化备案流程。</p>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/18/68a2aba5148d8.png\" alt=\"域名解析\"/></div><span class=\"image-caption\">域名解析</span></div>\n\n<p>在本地电脑打开终端，运行：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ping artalk.example.com</span><br></pre></td></tr></table></figure>\n\n<p>如果返回的ip是解析的ip，说明解析成功。</p>\n<h3 id=\"1-3-安装-Nginx\"><a href=\"#1-3-安装-Nginx\" class=\"headerlink\" title=\"1.3 安装 Nginx\"></a>1.3 安装 Nginx</h3><p>登录你的服务器，执行：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>Bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 更新包列表</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\"></span><br><span class=\"line\"># 安装 Nginx</span><br><span class=\"line\">sudo apt install nginx -y</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动并设置开机自启</span><br><span class=\"line\">sudo systemctl start nginx</span><br><span class=\"line\">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure>\n\n<p><strong>测试 Nginx 是否正常：</strong></p>\n<p>浏览器访问：<code>artalk.example.com</code>，看到Nginx欢迎页则说明安装成功。</p>\n<h3 id=\"1-4-创建-Nginx-配置文件-不启用-HPPTS\"><a href=\"#1-4-创建-Nginx-配置文件-不启用-HPPTS\" class=\"headerlink\" title=\"1.4 创建 Nginx 配置文件(不启用 HPPTS)\"></a>1.4 创建 Nginx 配置文件(不启用 HPPTS)</h3><ol>\n<li>创建文件</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/nginx/sites-available/artalk.xinghenluyus.cn.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><figcaption><span>nginx</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name artalk.xinghenluyus.cn;</span><br><span class=\"line\"></span><br><span class=\"line\">    # Certbot 验证路径</span><br><span class=\"line\">    location /.well-known/acme-challenge/ &#123;</span><br><span class=\"line\">        root /var/www/certbot;</span><br><span class=\"line\">        try_files $uri =404;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 其他请求先不重定向（或可重定向，但不能 listen 443）</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        # 可选：先不重定向，等证书申请完再开启</span><br><span class=\"line\">        proxy_pass http://127.0.0.1:8080;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Port $server_port;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Host $host;</span><br><span class=\"line\"></span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>测试配置</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>应该输出</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>重载Nginx</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-5-申请-Let’s-Encrypt-证书（Certbot-会自动配置-HTTPS）\"><a href=\"#1-5-申请-Let’s-Encrypt-证书（Certbot-会自动配置-HTTPS）\" class=\"headerlink\" title=\"1.5 申请 Let’s Encrypt 证书（Certbot 会自动配置 HTTPS）\"></a>1.5 申请 Let’s Encrypt 证书（Certbot 会自动配置 HTTPS）</h3><ol>\n<li>安装 Certbot</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>创建验证目录</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /var/www/certbot</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>创建验证目录</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d artalk.xinghenluyus.cn</span><br></pre></td></tr></table></figure>\n\n<p>按提示操作：</p>\n<ul>\n<li>输入邮箱（用于安全通知）</li>\n<li>同意服务条款（输入 Y）</li>\n<li>是否接收推广邮件？输入 N</li>\n<li>是否将 HTTP 重定向到 HTTPS？选择 2（强制重定向）</li>\n</ul>\n<h2 id=\"2-服务器安装-Artalk\"><a href=\"#2-服务器安装-Artalk\" class=\"headerlink\" title=\"2 服务器安装 Artalk\"></a>2 服务器安装 Artalk</h2><h3 id=\"2-1-程序部署\"><a href=\"#2-1-程序部署\" class=\"headerlink\" title=\"2.1 程序部署\"></a>2.1 程序部署</h3><p>执行命令在后台启动容器：</p>\n<p><em>请注意<code>ATK_SITE_DEFAULT</code>改成你的网站title(对应<code>_config.yml</code>文件中title)，<code>ATK_SITE_URL</code>改成服务器实际解析域名。</em></p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">    --name artalk \\</span><br><span class=\"line\">    -p 8080:23366 \\</span><br><span class=\"line\">    -v $(pwd)/data:/data \\</span><br><span class=\"line\">    -e &quot;TZ=Asia/Shanghai&quot; \\</span><br><span class=\"line\">    -e &quot;ATK_LOCALE=zh-CN&quot; \\</span><br><span class=\"line\">    -e &quot;ATK_SITE_DEFAULT=Artalk 的博客&quot; \\</span><br><span class=\"line\">    -e &quot;ATK_SITE_URL=https://artalk.example.com&quot; \\</span><br><span class=\"line\">    artalk/artalk-go</span><br></pre></td></tr></table></figure>\n\n<p>执行命令创建管理员账户：</p>\n<figure class=\"highlight plaintext\"><figcaption><span>bash</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it artalk artalk admin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-进入后台\"><a href=\"#2-2-进入后台\" class=\"headerlink\" title=\"2.2 进入后台\"></a>2.2 进入后台</h3><p>主机浏览器输入 <code>https://artalk.example.com</code> 进入 Artalk 后台登录界面。</p>\n<p><strong>如果这这一步不成功，自行在 1.4, 1.5, 2.1 之间排查原因。</strong></p>\n<h3 id=\"2-3-配置可信域名\"><a href=\"#2-3-配置可信域名\" class=\"headerlink\" title=\"2.3 配置可信域名\"></a>2.3 配置可信域名</h3><p>登录后台 -&gt; 设置 -&gt; 可信域名</p>\n<p>将你的博客域名 (<em>也就是要使用这个评论系统页面的所有域名</em>) 都添加到可信域名列表中，解决CORS报错。然后点击右下角<code>应用</code>。</p>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/18/68a2b864ea899.png\" alt=\"配置示例\"/></div><span class=\"image-caption\">配置示例</span></div>\n\n<h2 id=\"3-Volantis-配置-Artalk\"><a href=\"#3-Volantis-配置-Artalk\" class=\"headerlink\" title=\"3 Volantis 配置 Artalk\"></a>3 Volantis 配置 Artalk</h2><p>打开<code>_config.volantis.yml</code>文件，添加artalk相关配置</p>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/18/68a2bc7003aa2.png\" alt=\"_config.volantis.yml相关配置\"/></div><span class=\"image-caption\">_config.volantis.yml相关配置</span></div>\n\n<p>如果你的<code>Volantis</code>版本是<code>5.8.0</code>，则对于新版Artalk也就是2.9.1,<strong>浏览器会弹出pjax错误</strong>。</p>\n<p>这时有两个解决方案：</p>\n<ol>\n<li>如果你是通过npm安装的，可以打开<code>node_modules\\hexo-theme-volantis\\layout\\_plugins\\comments\\artalk\\script.ejs</code>，用下面代码替换源码。(记得做好备份工作)</li>\n</ol>\n<figure class=\"highlight plaintext\"><figcaption><span>script.ejs</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">  volantis.layoutHelper(&quot;comments&quot;, `&lt;div id=&quot;artalk_container&quot;&gt;&lt;i class=&quot;fa-solid fa-cog fa-spin fa-fw fa-2x&quot;&gt;&lt;/i&gt;&lt;/div&gt;`);</span><br><span class=\"line\"></span><br><span class=\"line\">  function load_artalk() &#123;</span><br><span class=\"line\">    if (!document.querySelector(&quot;#artalk_container&quot;)) return;</span><br><span class=\"line\"></span><br><span class=\"line\">    volantis.css(&quot;&lt;%- theme.comments.artalk.css %&gt;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    volantis.js(&quot;&lt;%- theme.comments.artalk.js %&gt;&quot;)</span><br><span class=\"line\">      .then(() =&gt; &#123;</span><br><span class=\"line\">        if (typeof Artalk === &#x27;undefined&#x27;) &#123;</span><br><span class=\"line\">          console.error(&#x27;Artalk.js loaded but Artalk is not defined&#x27;);</span><br><span class=\"line\">          return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return pjax_artalk();</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .catch(err =&gt; &#123;</span><br><span class=\"line\">        console.error(&#x27;Failed to load Artalk.js:&#x27;, err);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  function pjax_artalk() &#123;</span><br><span class=\"line\">    if (!document.querySelector(&quot;#artalk_container&quot;)) return;</span><br><span class=\"line\"></span><br><span class=\"line\">    let path = pdata.commentPath;</span><br><span class=\"line\">    let placeholder = pdata.commentPlaceholder || &quot;&lt;%= theme.comments.artalk.placeholder %&gt;&quot; || &quot;&quot;;</span><br><span class=\"line\">    if (!path) &#123;</span><br><span class=\"line\">      path = &#x27;&lt;%= theme.comments.artalk.path %&gt;&#x27; || decodeURI(window.location.pathname);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (!&#x27;&lt;%= config.permalink %&gt;&#x27;.includes(&#x27;/index.html&#x27;)) &#123;</span><br><span class=\"line\">      path = path.replace(/\\/index\\.html$/, &#x27;/&#x27;).replace(/\\.html$/, &#x27;&#x27;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    volantis.artalk = Artalk.init(Object.assign(&lt;%- JSON.stringify(theme.comments.artalk) %&gt;, &#123;</span><br><span class=\"line\">      el: &#x27;#artalk_container&#x27;,</span><br><span class=\"line\">      pageKey: path,</span><br><span class=\"line\">      pageTitle: document.title,</span><br><span class=\"line\">      placeholder: placeholder,</span><br><span class=\"line\">      useBackendConf: true,</span><br><span class=\"line\">      site: &#x27;&lt;%= config.title %&gt;&#x27;,</span><br><span class=\"line\">      darkMode: volantis.dark.mode === &quot;dark&quot;,</span><br><span class=\"line\">      pvEl: &#x27;#artalk_visitors&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;% if(!!theme.comments.artalk.imageUploader?.api)&#123; %&gt;</span><br><span class=\"line\">      imgUploader: function(file) &#123;</span><br><span class=\"line\">        let headers = new Headers();</span><br><span class=\"line\">        headers.set(&#x27;Accept&#x27;, &#x27;application/json&#x27;);</span><br><span class=\"line\">        &lt;% if(!!theme.comments.artalk.imageUploader?.token) &#123; %&gt;</span><br><span class=\"line\">          headers.set(&#x27;Authorization&#x27;, &#x27;&lt;%= theme.comments.artalk.imageUploader?.token %&gt;&#x27;);</span><br><span class=\"line\">        &lt;% &#125; %&gt;</span><br><span class=\"line\">        let formData = new FormData();</span><br><span class=\"line\">        formData.append(&#x27;file&#x27;, file);</span><br><span class=\"line\">        return fetch(&#x27;&lt;%= theme.comments.artalk.imageUploader?.api %&gt;&#x27;, &#123;</span><br><span class=\"line\">          method: &#x27;POST&#x27;,</span><br><span class=\"line\">          body: formData,</span><br><span class=\"line\">          headers: headers</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .then(resp =&gt; resp.json())</span><br><span class=\"line\">        .then(resp =&gt; resp.&lt;%= theme.comments.artalk.imageUploader?.resp %&gt;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &lt;% &#125; %&gt;</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">    Artalk.use(ctx =&gt; &#123;</span><br><span class=\"line\">      ctx.on(&#x27;list-loaded&#x27;, () =&gt; &#123;</span><br><span class=\"line\">        if (typeof VolantisFancyBox === &quot;undefined&quot;) &#123;</span><br><span class=\"line\">          const checkFancyBox = setInterval(() =&gt; &#123;</span><br><span class=\"line\">            if (typeof VolantisFancyBox === &quot;undefined&quot;) return;</span><br><span class=\"line\">            clearInterval(checkFancyBox);</span><br><span class=\"line\">            VolantisFancyBox.groupBind(&#x27;.atk-content img:not([atk-emoticon])&#x27;, &#x27;Comments&#x27;);</span><br><span class=\"line\">          &#125;, 100);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">          VolantisFancyBox.groupBind(&#x27;.atk-content img:not([atk-emoticon])&#x27;, &#x27;Comments&#x27;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  load_artalk();</span><br><span class=\"line\"></span><br><span class=\"line\">  volantis.pjax.push(() =&gt; &#123;</span><br><span class=\"line\">    if (typeof Artalk === &quot;undefined&quot;) &#123;</span><br><span class=\"line\">      load_artalk();</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      pjax_artalk();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;, &#x27;artalk&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">  function dark_artalk() &#123;</span><br><span class=\"line\">    if (!document.querySelector(&quot;#artalk_container&quot;)) return;</span><br><span class=\"line\">    if (volantis.artalk &amp;&amp; typeof volantis.artalk.setDarkMode === &#x27;function&#x27;) &#123;</span><br><span class=\"line\">      volantis.artalk.setDarkMode(volantis.dark.mode === &quot;dark&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  volantis.dark.push(dark_artalk);</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>如果你是通过拉取仓库源码方式安装，可以拉取仓库最新的<code>dev</code>分支，我的代码已经被合并到dev分支，暂时还没作为5.8.1版本发布。</li>\n</ol>\n<div class=\"img-wrap\"><div class=\"img-bg\"><img class=\"img\" src=\"https://bu.dusays.com/2025/08/18/68a2c066e9085.png\" alt=\"dev分支\"/></div><span class=\"image-caption\">dev分支</span></div>\n\n\n<span class='p center h1 black'>到这里你的blog已经成功集成Artalk啦！</span>","categories":[{"name":"编程之外","path":"api/categories/编程之外.json"}],"tags":[{"name":"教程","path":"api/tags/教程.json"}]}